<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="renderer" content="webkit">
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <title>忆寻-admin</title>

    <meta name="keywords" content="">
    <meta name="description" content="">

    <!--[if lt IE 9]>
    <meta http-equiv="refresh" content="0;ie.html" />
    <![endif]-->

    <css href="/static/css/admin/bootstrap.min14ed.css" />
	<css href="/static/css/admin/font-awesome.min93e3.css" />
	<css href="/static/css/admin/plugins/dataTables/dataTables.bootstrap.css">
	<css href="/static/css/admin/animate.min.css" />
	<css href="/static/css/admin/style.min862f.css"/>
    <!-- <css href="/static/css/admin/common.css"/> -->
    <link href="/static/css/admin/admincommon.css?v=20180712" rel='stylesheet' type='text/css' />
</head>

<body class="gray-bg">
    <div class="wrapper wrapper-content animated fadeInRight">
        <div class="row">
            <div class="col-sm-12">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h5>角色管理</h5>
                        <div class="ibox-tools">
                            <button id="toggle_modal" class="btn btn-primary btn-circle" type="button" style="margin-bottom:0px;margin-right:10px;position:relative;top:-5px;" title="添加角色">
                                <i class="fa fa-group"></i>+
                            </button>
                        </div>
                    </div>
                    <div class="ibox-content">
                        <table class="table table-striped table-bordered table-hover dataTables-example">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>角色名</th>
                                    <th>描述</th>
                                    <th>加入时间</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                <volist name="roles" id="vo">
                                    <tr class="gradeX" id="role-{$vo['role_id']}">
                                        <td>{$vo['role_id']}</td>
                                        <td>{$vo['role_name']}</td>
                                        <td>{$vo['role_describe']}</td>
                                        <td class="center">{$vo['role_add_time']}</td>
                                        <td class="center" align="center">
                                            <div class="btn-group">
                                                
                                                <if condition="$vo['role_id'] eq 1">
                                                    <if condition="$Request.session.user_id eq 1">
                                                        <button data-toggle="dropdown" class="btn btn-primary btn-xs dropdown-toggle" aria-expanded="false">操作 <span class="caret"></span>
                                                        </button>
                                                        <ul class="dropdown-menu">
                                                            <li>
                                                                <a href="javascript:;" class="font-bold edit-role" data-id="{$vo['role_id']}">修改</a>
                                                            </li>
                                                        </ul>
                                                    <else/>
                                                        <button data-toggle="dropdown" class="btn btn-primary btn-xs disabled" aria-expanded="false">操作 <span class="caret"></span>
                                                        </button>
                                                    </if>
                                                    
                                                <else/>
                                                    <button data-toggle="dropdown" class="btn btn-primary btn-xs dropdown-toggle" aria-expanded="false">操作 <span class="caret"></span>
                                                    </button>
                                                    <ul class="dropdown-menu">
                                                        <li>
                                                            <a href="javascript:;" class="font-bold edit-role" data-id="{$vo['role_id']}">修改</a>
                                                        </li>
                                                        <li>
                                                            <a href="javascript:;" class="font-bold del-role" data-id="{$vo['role_id']}">删除</a>
                                                        </li>
                                                    </ul>
                                                </if>
                                               
                                            </div>
                                        </td>
                                    </tr>
                                </volist>
                            </tbody>
                            <tfoot>
                                <tr>
                                    <th>ID</th>
                                    <th>角色名</th>
                                    <th>描述</th>
                                    <th>加入时间</th>
                                    <th>操作</th>
                                </tr>
                            </tfoot>
                        </table>

                    </div>
                </div>
            </div>
        </div>
    </div>
     <div id="role-modal-form" class="modal fade" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form id="role_form" action="" method="post" onsubmit="return false;">
                    <div class="modal-header">
                        <span class="refresh-btn" onclick="refresh_form('role_form');"><i class="fa fa-refresh"></i></span>
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title" id="myModalLabel">添加角色</h4>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-sm-12">
                                <div class="form-group">
                                    <label>角色名：</label>
                                    <input type="text" name="role_name" value="" id="role_name" placeholder="输入角色名" class="form-control">
                                </div>

                                <div class="form-group">
                                    <label>描述：</label>
                                    <textarea name="role_describe" value="" id="role_describe" class="form-control" placeholder="输入角色描述"  style="margin:0px; height: 93px; max-width:100%;"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <input type="hidden" id="role_id" name="role_id" value="" />
                        <input type="hidden" id="handle_type"  name="handle_type"  value="add" />
                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                        <button type="submit" class="btn btn-primary" onclick="roleSubmit();">确定</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <js href="/static/js/admin/jquery.min.js"/>
	<js href="/static/js/admin/bootstrap.min.js"/>
	<js href="/static/js/admin/plugins/dataTables/jquery.dataTables.js"/>
	<js href="/static/js/admin/plugins/dataTables/dataTables.bootstrap.js"/>
	<js href="/static/js/admin/content.min.js"/>
    <js href="/static/js/admin/plugins/layui/layer/layer.js"/>
    <!-- <js href="/static/js/admin/admincommon.js"/> -->
    <script type="text/javascript" src="/static/js/admin/admincommon.js?v=20180712"></script>
    <script>
        $(document).ready(function(){
            $(".dataTables-example").dataTable();

            $(".ibox-content").on('click','.edit-role',function(){

                var roleId = $(this).data("id");

                $.post("{:url('admin/Role/getRole')}",{role_id:roleId},function(data){
                    
                    if(data.code==1) {
                       
                        $("#role_id").val(data.data.role_id);
                        $("#role_name").val(data.data.role_name);
                        $("#role_describe").val(data.data.role_describe);

                    }else{
                        
                        layer.msg(data.msg, {time:500, icon:5});  
                    }

                },'json');

                $("#handle_type").val('update');
                $("#role-modal-form").modal('show');
            });
            
            $(".ibox-content").on('click','.del-role',function(){
                
                var roleId = $(this).data("id");

                $.post("{:url('admin/Role/delRole')}",{role_id:roleId},function(data){
                    
                    if(data.code==1) {

                        layer.msg(data.msg, {time:500, icon:6});
                         
                        $("#role-"+roleId).remove();

                    }else{
                    
                        layer.msg(data.msg, {time:500, icon:5});

                    }

                },'json');

            });


            $("#toggle_modal").on('click',function(){

                var index = layer.open({
                  title:'添加角色',
                  offset: ['120px', '220px'],
                  isOutAnim: true ,
                  type: 2,
                  content:"{:url('admin/Role/roleAuth')}",
                  area: ['800px','400px'],
                  maxmin: true
                });

                layer.full(index);

            });
        });

        function roleSubmit() {
            
            var handle_type = $("#handle_type").val();
            var data        = $("#role_form").serializeArray();
            var url         = '';
 
            if($.trim($("input[name='role_name']").val()) == '') {

                layer.msg('请填角色名', {time:500, icon:5});  
                return false; 
            }
            
            if(handle_type == 'add') 
                url = "{:url('admin/Role/addRole')}";
            else if(handle_type == 'update')
                url = "{:url('admin/Role/updateRole')}";

            $.post(url,data,function(data){
                if(data.code==1) {

                   layer.msg(data.msg, {time:500, icon:6}); 

                }else{
                   layer.msg(data.msg, {time:500, icon:5});  
                }

            },'json');
        }

    </script>

</body>
</html>